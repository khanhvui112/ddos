(function saveProxiesBrowser() {
  const list = [];

  document.querySelectorAll('.spy14').forEach(el => {
    const clone = el.cloneNode(true);
    // loại bỏ script và các font con
    clone.querySelectorAll('script, font').forEach(n => n.remove());
    const text = clone.textContent.trim();
    const m = text.match(/(\d{1,3}(?:\.\d{1,3}){3}):(\d{1,5})/);
    if (m) list.push(`${m[1]}:${m[2]}`);
  });

  if (list.length === 0) {
    console.warn('Không tìm thấy host:port nào.');
    return;
  }

  // nối thành chuỗi, mỗi dòng một proxy
  const content = list.join('\n');

  // tạo blob và tạo link download
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'proxies.txt';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);

  console.log(`Saved ${list.length} proxies to proxies.txt`);
})();
